import { isObjectLike } from '../compat/predicate/isObjectLike.mjs';

function merge(target, source) {
    const sourceKeys = Object.keys(source);
    for (let i = 0; i < sourceKeys.length; i++) {
        const key = sourceKeys[i];
        const sourceValue = source[key];
        const targetValue = target[key];
        if (Array.isArray(sourceValue)) {
            target[key] = merge(targetValue ?? [], sourceValue);
        }
        else if (isObjectLike(targetValue) && isObjectLike(sourceValue)) {
            target[key] = merge(targetValue ?? {}, sourceValue);
        }
        else if (targetValue === undefined || sourceValue !== undefined) {
            target[key] = sourceValue;
        }
    }
    return target;
}

export { merge };
